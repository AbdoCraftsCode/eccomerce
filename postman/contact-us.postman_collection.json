{
  "info": {
    "name": "Contact Us API",
    "_postman_id": "contact-us-api-collection",
    "description": "Complete REST API endpoints for Contact Us (Chat Support) module",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{authToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "User Endpoints",
      "item": [
        {
          "name": "Get My Chat",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has success field\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success', true);",
                  "});",
                  "",
                  "pm.test(\"Response has data with messages\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('messages');",
                  "    pm.expect(jsonData.data).to.have.property('pagination');",
                  "});",
                  "",
                  "// Save chatId for later use",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set(\"chatId\", jsonData.data._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept-Language",
                "value": "{{language}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/contactUs/my-chat?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["contactUs", "my-chat"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number (default: 1)"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Messages per page (max: 100, default: 50)"
                }
              ]
            },
            "description": "Fetch user's own chat with pagination. Automatically creates a chat if one doesn't exist."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Admin Endpoints",
      "item": [
        {
          "name": "Get All Chats (Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has chats array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('data');",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"Response has pagination and meta\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('pagination');",
                  "    pm.expect(jsonData).to.have.property('meta');",
                  "});",
                  "",
                  "// Save first chatId for next request",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.data.length > 0) {",
                  "        pm.collectionVariables.set(\"adminChatId\", jsonData.data[0]._id);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept-Language",
                "value": "{{language}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/contactUs/admin/chats?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["contactUs", "admin", "chats"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number (default: 1)"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Chats per page (max: 100, default: 20)"
                }
              ]
            },
            "description": "Get all chats sorted by last message time. Admin/Owner only."
          },
          "response": []
        },
        {
          "name": "Get Chat by ID (Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has chat data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('messages');",
                  "    pm.expect(jsonData.data).to.have.property('user');",
                  "    pm.expect(jsonData.data).to.have.property('totalMessages');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept-Language",
                "value": "{{language}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/contactUs/admin/chats/{{adminChatId}}?page=1&limit=50",
              "host": ["{{baseUrl}}"],
              "path": ["contactUs", "admin", "chats", "{{adminChatId}}"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number (default: 1)"
                },
                {
                  "key": "limit",
                  "value": "50",
                  "description": "Messages per page (max: 100, default: 50)"
                }
              ]
            },
            "description": "Get specific chat by ID with paginated messages. Admin/Owner only."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Error Cases",
      "item": [
        {
          "name": "Unauthorized Access (No Token)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/contactUs/my-chat",
              "host": ["{{baseUrl}}"],
              "path": ["contactUs", "my-chat"]
            },
            "description": "Test accessing endpoint without authentication token"
          },
          "response": []
        },
        {
          "name": "Admin Endpoint with User Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 403\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/contactUs/admin/chats",
              "host": ["{{baseUrl}}"],
              "path": ["contactUs", "admin", "chats"]
            },
            "description": "Test accessing admin endpoint with regular user token (should fail with 403)"
          },
          "response": []
        },
        {
          "name": "Invalid Chat ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400 or 404\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{adminToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/contactUs/admin/chats/invalid-id",
              "host": ["{{baseUrl}}"],
              "path": ["contactUs", "admin", "chats", "invalid-id"]
            },
            "description": "Test with invalid MongoDB ObjectID format"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "chatId",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminChatId",
      "value": "",
      "type": "string"
    }
  ]
}
